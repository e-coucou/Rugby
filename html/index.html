<!DOCTYPE html>
<title>RUGBY WORLD CUP</title>
<meta name="description" content="Interactive visualisation Rugby Ranking IRB.">
<meta name="author" content="e-Coucou">
<html class="ocks-org do-not-copy">
<meta charset="utf-8">
<title>Ranking evolution</title>
<link rel="stylesheet" href="css/style.css">
<style>

@import url(../css/visu.css?aea6f0a);

#chart {
  margin-left: -40px;
  height: 506px;
}

text {
  font: 10px sans-serif;
}

.dot {
  stroke: #000;
}

.axis path, .axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.label {
  fill: #777;
}

.year.label {
  font: 500 112px "Helvetica Neue";
  fill: #ddd;
}

.year.label.active {
  fill: #48b;
}
.pays.label {
    font: 500 48px "Helvetica Neue";
    fill: #bce;
}

.overlay {
  fill: none;
  pointer-events: all;
  cursor: ew-resize;
}

</style>

<header>
  <aside>Octobre, 2015</aside>
  <a href="index.html" rel="author">e-Coucou</a>
  <a href="wrc.html" rel="author">WRC Graphes</a>
</header>

<h1>Ranking IRB depuis 2003</h1>

<p id="chart"></p>

<aside>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://rugby-rky.herokuapp.com/index.html" data-via="EricP_">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</aside><br>
<aside>Passez la souris au dessus de l'année pour vous déplacer dans le temps.</aside>
<p class="attribution">Source: <a href="https://github.com/e-coucou/Rugby">e-Coucou</a>, <a href="http://www.pulselive.com">PulseLive</a>.

<p>Petite visualisation utilisant la bibliothèque <a href="http://d3js.org/">D3</a>. Elle montre l'évolution des classements IRB. Les données sur le Rugby sont collectées par <a href="http://www.pulselive.com/">Puslive</a>. L'IRB classe les équipes de Rugby depuis 2003, chaque rencontre permet l'attribution de points en fonction de l'enjeux et de l'écart du score (pour info en Coupe du Mande les points comptent double). Le maximum de points est 100.</p>
<p>Les abscisses (<i>x</i>) représentent le nombre de points, en ordonnée (<i>y</i>) le classement et le nombre de matches disputés par an est représenté par la taille de la pastille (rayon). Les Pays sont coloriés aléatoirement. En passant la souris sur les pastilles vous pourrez découvrir les noms, points et classement.
<p>à venir le classement des équipes fémines ...</p>
<footer>
    <p>Mille et un remerciements à <a href="http://bl.ocks.org/mbostock">Mike Bostock</a> et à <a href="http://alignedleft.com/tutorials/d3/">Scott Murray</a>.</p>
    <aside>Data : 19 Octobre 2015</aside>
    <a href="index.html" rel="author">e-Coucou</a>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script></script>
<script>

// Various accessors that specify the four dimensions of data to visualize.
function x(d) { return (d.points); }
function y(d) { return (d.rank); }
function radius(d) { return d.matchs; }
function color(d) { return d.name; }  // region
function key(d) { return d.name; }

// Chart dimensions.
var margin = {top: 19.5, right: 19.5, bottom: 19.5, left: 39.5},
    width = 960 - margin.right,
    height = 500 - margin.top - margin.bottom;

// Various scales. These domains make assumptions of data, naturally.
var xScale = d3.scale.linear().domain([0, 100]).range([0, width]),  // vs log
    yScale = d3.scale.linear().domain([0, 100]).range([0,height]),
    radiusScale = d3.scale.sqrt().domain([1, 200]).range([1, 20]),
    colorScale = d3.scale.category20();  //10

// The x & y axes.
var xAxis = d3.svg.axis().orient("bottom").scale(xScale).ticks(18, d3.format(",d")),
    yAxis = d3.svg.axis().scale(yScale).orient("left");

// Create the SVG container and set the origin.
var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// Add the x-axis.
svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

// Add the y-axis.
svg.append("g")
    .attr("class", "y axis")
    .call(yAxis);

// Add an x-axis label.
svg.append("text")
    .attr("class", "x label")
    .attr("text-anchor", "end")
    .attr("x", width)
    .attr("y", height - 6)
    .text("nombre de points");

// Add a y-axis label.
svg.append("text")
    .attr("class", "y label")
    .attr("text-anchor", "end")
    .attr("y", 6)
    .attr("dy", ".75em")
    .attr("transform", "rotate(-90)")
    .text("ranking");

// Add the year label; the value is set on transition.
var label = svg.append("text")
    .attr("class", "year label")
    .attr("text-anchor", "end")
    .attr("y", height - 24)
    .attr("x", width)
    .text('12/2003');

// Add the year label; the value is set on transition.
var pays = svg.append("text")
    .attr("class", "pays label")
    .attr("text-anchor", "begin")
    .attr("y", 44)
    .attr("x", 24)
    .text('France');

// Load the data.
d3.json("data/ranking.json", function(irb) {

  // A bisector since many nation's data is sparsely-defined.
  var bisect = d3.bisector(function(d) { return d[0]; });

  // Add a dot per nation. Initialize the data at 2003, and set the colors... 20 aleatoires
  var dot = svg.append("g")
    .attr("class", "dots")
    .selectAll(".dot")
    .data(interpolateData(2003.5))
    .enter().append("circle")
    .attr("class", "dot")
    .style("fill", function(d) { return colorScale(color(d)); })
    .call(position)
    .on("mouseover",function(d) {return pays.text(d.rank+'- '+d.name+' ('+Math.floor(d.points*10)/10+')');})
        .on("click", function(d) { return trace_test(d.name);})
//        .on("click", function (d) {return d3.select(this).style("fill",d3.rgb(255,0,0));})
    .sort(order);

  // Add a title.
  dot.append("title")
      .text(function(d) { return d.name; });

  // Add trace
  var trace =svg.append("h")
    .attr("class", "dots")
    .selectAll(".dot")
//    .data(parcourt())
//    .enter().append("circle")
    .attr("class", "dot");
	
  // Add an overlay for the year label.
  var box = label.node().getBBox();

  var overlay = svg.append("rect")
        .attr("class", "overlay")
        .attr("x", box.x)
        .attr("y", box.y)
        .attr("width", box.width)
        .attr("height", box.height)
        .on("mouseover", enableInteraction);

  // Start a transition that interpolates the data based on year.
  svg.transition()
      .duration(30000)
      .ease("linear")
      .tween("year", tweenYear)
      .each("end", enableInteraction);

  // Positions the dots based on data.
  function position(dot) {
    dot .attr("cx", function(d) { return xScale(x(d)); })
        .attr("cy", function(d) { return yScale(y(d)); })
        .attr("r", function(d) { return radiusScale(radius(d)); });
  }

  // Defines a sort order so that the smallest dots are drawn on top.
  function order(a, b) {
    return radius(b) - radius(a);
  }

  // After the transition finishes, you can mouseover to change the year.
  function enableInteraction() {
    var yearScale = d3.scale.linear()
        .domain([2003, 2016])
        .range([box.x + 10, box.x + box.width - 10])
        .clamp(true);

    // Cancel the current transition, if any.
    svg.transition().duration(0);

    overlay
        .on("mouseover", mouseover)
        .on("mouseout", mouseout)
        .on("mousemove", mousemove)
        .on("touchmove", mousemove);

    function mouseover() {
      label.classed("active", true);
    }

    function mouseout() {
      label.classed("active", false);
    }

    function mousemove() {
      displayYear(yearScale.invert(d3.mouse(this)[0]));
    }
  }

  // Tweens the entire chart by first tweening the year, and then the data.
  // For the interpolated data, the dots and label are redrawn.
  function tweenYear() {
    var year = d3.interpolateNumber(2003, 2016);
    return function(t) { displayYear(year(t)); };
  }

  // Updates the display to show the specified year.
  function displayYear(year) {
    dot.data(interpolateData(year), key).call(position).sort(order);
    label.text(Math.round((year-Math.floor(year))*12)+'/'+Math.floor(year));
  }

  // Interpolates the dataset for the given (fractional) year.
  function interpolateData(year) {
    return irb.map(function(d) {
      return {
        name: d.name,
        region: d.region,
        points: interpolateValues(d.points, year),
        matchs: interpolateValues(d.matchs, year),
        rank: interpolateValues(d.rank, year)
      };
    });
  }
  var test=[];
  // tracé du parcourt ...
  function parcourt(name,annee) {
           //return 
		   irb.forEach(function(d) {
            if (d.name == name) {
//		console.log(interpolateValues(d.points, annee))
//		console.log(interpolateValues(d.rank, annee))
             var l =  test.push( {
                 points: interpolateValues(d.points, annee),
                 rank: interpolateValues(d.rank, annee)
                };);
            }
        });
  }
    function trace_test(name) {
		parcourt(name,2004.0)
		console.log(test)
        trace.data(parcourt(name,2004.0))
        .enter()
        .append("circle")
        .attr("cx", function(d) { return xScale(x(d)); })
        .attr("cy", function(d) { return yScale(y(d)); })
        .attr("r", function(d) { return radiusScale(1); });
        }
  // Finds (and possibly interpolates) the value for the specified year.
  function interpolateValues(values, year) {
    var i = bisect.left(values, year, 0, values.length - 1),
        a = values[i];
//    if (i > 0) {
//      var b = values[i - 1],
//          t = (year - a[0]) / (b[0] - a[0]);
//      return a[1] * (1 - t) + b[1] * t;
//    }
    return a[1];
  }
});

</script>
<!--<script>

GoogleAnalyticsObject = "ga", ga = function() { ga.q.push(arguments); }, ga.q = [], ga.l = +new Date;
ga("create", "UA-48272912-3", "ocks.org");
ga("send", "pageview");

</script>-->
<script async src="//www.google-analytics.com/analytics.js"></script>