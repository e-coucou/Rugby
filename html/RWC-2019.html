<!DOCTYPE html>
<title>RWC</title>
<meta name="description" content="Suivi de match Rugby World Cup 2019.">
<meta name="author" content="e-Coucou">
<html class="rky">
<meta charset="utf-8">
<title>Rugby World Championship</title>
<style>
@import url(../css/dsp.css);
.rky header{
    height: 47px;
}
#chart {
	position : absolute;
	background-color : lightcyan;
}
#retour {
    position : absolute;
    right: 25px;
    margin-top: 50px;
}
#intervalle {
    position: absolute;
    top: 15px;
    right: 163px;
}
#infoLive {
    position: absolute;
    top: 50px;
    font: 10px sans-serif;
    left: 20px;
    font-family: "helvetica neue", sans-serif;
    color: #191970;
}
#comp_select {
    position: absolute;
    right: 250px;
    top: 15px;
}
#defilementUP {
    position: absolute;
    right: 218px;
    top: 10px;
}
#defilementDOWN {
    position: absolute;
    right: 407px;
    top: 10px;
}
text {
  font: 10px sans-serif;
}
.label {
    fill: #777;
}
.rky header {
    background: #1e3F5E;
}
table {
    font-family: "helvetica neue", sans-serif;
}
</style>
<body>
<header>
  <div id='h1'>Rugby World Cup</div>
  <aside >Septembre, 2019<br><br>| v 7.12</aside>
  <div id='menu'></div>
  <div id='defilementUP'></div>
  <div id='defilementDOWN'></div>
  <div id='intervalle'></div>
  <select id="comp_select" class="styledSelect">
        <optgroup label="ChampionShip from IRB.">
        <option value=1>World Cup</option>
        <option value=2 selected="">Six Nations</option>
        <option value=3>Tri Nations</option>
        <option value=4>TOP 3</option>
        <option value=5>Pacific Nations Cup</option>
        </optgroup>
  </select>
</header>
<footer>
    <aside>(c) e-Coucou | y2kL | Live Data</aside>
    <div id="info"></div>
</footer>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://unpkg.com/d3@5.7.0/dist/d3.min.js" charset="utf-8"></script>
	<script src="../js/menu.js" charset="utf-8"></script>
	<script defer src="../js/all.js"></script>
    <div id="chart"></div>
    <div id="infoLive">Live info ...</div>
    <div id="retour"></div>
  <script type="text/javascript">
	var rwc_index = [[ "1","2","3","4","5","952","1023","1238","1558"],["145","344","854","883","913","927","965","1005","1054","1077","1164","1184","1243","1244","1622","1623","1782","1783","1933","1934"],["1183","1236","1296","1557","364","714","855","886","926","940","970","995","1056","1135","1697","1764","1807","1992"],["1577","2015"],["925","957","971","1006","1072","1130","1166","1235","1273","1569","1653","1769"]]; // rwc , six nation , 4 nations , xx , wrc pacific
    // format ...
    let valFormat = (a) => {
        let r = (a>100) ? Math.round(a) : ( (a>1)? Math.round(a*100.0)/100 : Math.round(a*1000.0)/1000);
        return String(r).replace(/(.)(?=(\d{3})+$)/g,'$1 ');
//        return r;
        }
	// Chart dimensions.
	var margin = {top: 5, right: 20, bottom: 10, left: 50},
		width = window.innerWidth; // - margin.right-margin.left,
		height = 1350; //window.innerHeight;// 1350 - margin.top - margin.bottom;
	// Create the SVG container and set the origin.
    var svg = d3.select("#chart").append("svg")
        .attr("width", width -5) //+ margin.left + margin.right)
        .attr("height", height) // + margin.top + margin.bottom)
        .attr("position", 2);

	var dispatch = d3.dispatch('load','match','live','rank','timeline');
    dispatch.on('load',affListe);
    dispatch.on('match',affInfo);
    dispatch.on('live',affLive);
    dispatch.on('rank',updateRank);
    dispatch.on('timeline',affTimeline);

	var UPtriange = [ 'M -20 -10 L -10 10 L -30 10 L -20 -10', 'M -20 10 L -10 -10 L -30 -10 L -20 10'];
    var  selMenu=0;
    menu(selMenu);
    var idComp=1, nbComp=rwc_index[idComp].length, iComp=nbComp-1;
    var idLive=0, clock='';
    var teams = [], idRank=0, dataRank=[],teamsInfo=[], nbTeams=-1, dataStandings=[],dataStats=[];
    var url = '';
    var dataTimeline=[];
    var teamColor=['#006','#0bc'];
    var UP = 1, page =0;
    var listeMatchs=[],dataInfo=[];
    var t = setInterval(cycle,5000), t_veille = setInterval(veille,300000);
    init();

    d3.select("#comp_select").on("change", change);

//--------------
// INIT ...
function init() {
    idComp=1; nbComp=rwc_index[idComp].length; iComp=nbComp-1;
    idLive=0; clock='';
    teams = []; idRank=0; dataRank=[];teamsInfo=[]; nbTeams=-1; dataStandings=[];dataStats=[];
    url = ''; dataTimeline=[]; teamColor=['#006','#0bc']; UP = 1;
    listeMatchs=[];dataInfo=[];
//    t = setInterval(cycle,5000); t_veille = setInterval(veille,300000);
    clearInterval(t);
    changeComp();
    updateComp(1);
}

//--------------
// cycle
async function cycle() {
	clearInterval(t_veille);
	var urlMatch = 'http://cmsapi.pulselive.com/rugby/match/'+idLive+'/summary';
			//infoMatch=[];
	getData(urlMatch,2);
	await timeline(idLive);
}
// veille
function veille() {
        var urlRWC = 'http://cmsapi.pulselive.com/rugby/event/'+rwc_index[idComp][iComp]+'/schedule';
		getData(urlRWC,1);
		console.log('veille....');
}
// standings
function standings() { //old async
    console.log('get standings');
    var urlStandings = 'http://cmsapi.pulselive.com/rugby/event/'+rwc_index[idComp][iComp]+'/standings';
    dataStandings=[];
//    dataStandings = await getData2(urlStandings);
    getData(urlStandings,6);
    console.log('STANDINGS ...',urlStandings , dataStandings);
}
// timeline
async function timeline(id) {
	console.log('get Timeline ...', id);
	var urlTimeline = 'http://cmsapi.pulselive.com/rugby/match/'+id+'/timeline';
    dataTimeline = [];
    dataTimeline = await getData2(urlTimeline);
    console.log(dataTimeline);
    //	getData(urlTimeline,5);
}
async function stats(id) {
    console.log('get stats');
    let urlStats = 'http://cmsapi.pulselive.com/rugby/match/25290/stats';
    dataStats=[];
    dataStats = await getData2(urlStats);
    console.log(dataStats);
}
function affTimeline() {
	try {
		let l=dataTimeline.timeline.length;
		console.log('time line : ',dataTimeline);
	} catch(e) {console.log('timeline out');}
}
//--------------
// update Compétition
function updateComp(id) {
        if (id==undefined) iComp = (iComp+1) % nbComp;
        codeCup = rwc_index[idComp][iComp]; //[1][17];
        console.log(id,idComp,iComp,codeCup);
        clearInterval(t);
        standings();
        console.log('wait for standings ?');
        urlRWC = 'http://cmsapi.pulselive.com/rugby/event/'+codeCup+'/schedule';
        getData(urlRWC,1);
		if (idLive != 0) {
			urlMatch = 'http://cmsapi.pulselive.com/rugby/match/'+idLive+'/summary';
			infoMatch=[];
			getData(urlMatch,2);
		}
}
function updateCompUP() {
        iComp = (iComp+1) % nbComp;
        updateComp(-1)
}
function updateCompDOWN() {
        iComp = iComp>0?(iComp-1):(nbComp-1);
        updateComp(-1)
}
function inverseSORT() {
        UP = -UP;
        d3.select('#updw').attr('fill','red')
            .attr('d',UPtriange[(1+UP)/2])
        updateComp(-1);
}

function change() {
    idComp = d3.select("#comp_select").property("value") - 1;
    nbComp=rwc_index[idComp].length;
    iComp=nbComp-1;
    teams = [];idRank=0; dataRank=[];teamsInfo=[]; nbTeams=-1; dataStandings=[];dataStats=[];
    url = '';
    dataTimeline=[];
    listeMatchs=[];dataInfo=[];
    updateComp(-1);
}

//--------------
// change comp
function changeComp() {
//    d3.select('#intervalle').remove();
//    d3.select('#retour').remove();
//    d3.select('body').append('div').attr('id','graphe')

    var svgInt = d3.select("#intervalle").append("svg")
        .attr('width',50).attr('height',30)
        .attr("position", 1)
        .append("g").raise()
        .attr('transform',function (d,i){ return ('translate('+ (30)+','+(10)+')');});

//var interG = svgInt.selectAll('g').data(IntervalData).enter()
//    .append('g')
//    .attr('transform',function (d,i){ return ('translate('+ (intWidth-20-i*25)+','+11+')');})
//    .on('click',click);

//    svgInt.append('circle').attr('fill','#2E2D88')
//        .attr('r',10).attr('cx',-25)
    svgInt.append('path').attr('fill','#B233FF').attr('id','updw')
        .attr('d',UPtriange[(1+UP)/2])
        .on('click',inverseSORT)
        .on('mouseover',function(d,i){ d3.select(this).attr('fill','#33E6FF');})
        .on('mouseout',function(d,i){ d3.select(this).attr('fill','#B233FF');});

// boutons de défilement ...
    var svgUP = d3.select("#defilementUP").append("svg")
        .attr('width',35).attr('height',35)
        .append("g").raise()
        .attr('transform',function (d,i){ return ('translate('+ (5)+','+(4)+')');})
        .on('mouseover',function(d,i){ d3.select('#defilementUP').selectAll('rect').style('fill','#33CAFF');
                                       d3.select('#defilementUP').selectAll('text').style('fill','white');})
        .on('mouseout',function(d,i){ d3.select('#defilementUP').selectAll('rect').style('fill','ivory');
                                      d3.select('#defilementUP').selectAll('text').style('fill','#212');})
        .on('click',updateCompUP);
    svgUP.append('rect').attr('fill','white')
        .attr('rx',5).attr('ry',5).style('stroke-width',2).style('stroke','#24a')
        .attr('width',30).attr('height',21).style('fill','ivory');//.style('stroke-color', (d,i)=>teamColor[i]);
    svgUP.append('text').attr('x',0).attr('dx',15).attr('y',11)
            .style('fill','#212').style('text-anchor', 'middle').style('font-weight', 'bold').style('dominant-baseline','middle')
            .text('>>').style('font-size','1.3vw');

    var svgDOWN = d3.select("#defilementDOWN").append("svg")
        .attr('width',35).attr('height',35)
        .append("g").raise()
        .attr('transform',function (d,i){ return ('translate('+ (5)+','+(4)+')');})
        .on('mouseover',function(d,i){ d3.select('#defilementDOWN').selectAll('rect').style('fill','#33CAFF');
                                       d3.select('#defilementDOWN').selectAll('text').style('fill','white');})
        .on('mouseout',function(d,i){ d3.select('#defilementDOWN').selectAll('rect').style('fill','ivory');
                                      d3.select('#defilementDOWN').selectAll('text').style('fill','#212');})
        .on('click',updateCompDOWN);
    svgDOWN.append('rect').attr('fill','white')
        .attr('rx',5).attr('ry',5).style('stroke-width',2).style('stroke','#24a')
        .attr('width',30).attr('height',21).style('fill','ivory');//.style('stroke-color', (d,i)=>teamColor[i]);
    svgDOWN.append('text').attr('x',0).attr('dx',15).attr('y',11)
            .style('fill','#212').style('text-anchor', 'middle').style('font-weight', 'bold').style('dominant-baseline','middle')
            .text('<<').style('font-size','1.3vw');

// boutons de retour
    console.log("bouton retour ...");
    var svgRet = d3.select("#retour").append("svg")
        .attr('width',160).attr('height',30)
        .append("g").raise()
        .attr('transform',function (d,i){ return ('translate('+ (1)+','+(1)+')');})
            .on('mouseover',function(d,i){ d3.select('#retour').selectAll('rect').style('fill','red');
                                           d3.select('#retour').selectAll('text').style('fill','white');})
            .on('mouseout',function(d,i){ d3.select('#retour').selectAll('rect').style('fill','ivory');
                                          d3.select('#retour').selectAll('text').style('fill','#212');})
                    .on('click',retour);
    svgRet.append('rect').attr('fill','#black')
            .attr('rx',5).attr('ry',5).style('stroke-width',2).style('stroke','#24a')
            .attr('width',155).attr('height',25).style('fill','ivory');//.style('stroke-color', (d,i)=>teamColor[i]);
    svgRet.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',78).attr('y',15) //.attr('id',(d)=>{return ('en0_'+d.matchId);})
            //.style('fill', (d,i,a) => { return a[i].__data__>a[(i+1)%2].__data__?'#fff':'#ccc';})
            .style('fill','#212')
            .style('text-anchor', 'middle')
            .style('font-weight', 'bold').style('dominant-baseline','middle')
            .text('<< LISTE >>').style('font-size','1.5vw');

    d3.select("#intervalle").selectAll('g').style('visibility',(d)=> {return page===0?'visible':'hidden';})
    d3.select("#retour").selectAll('g').style('visibility',(d)=> {return page===1?'visible':'hidden';})
    d3.select("#intervalle").raise();
    d3.select("#defilementUP").raise();
    d3.select("#defilementDOWN").raise();
}
//----------
function retour() {
    page=0; updateBouton();
    updateComp(-1);
} // end retour
//--------
function updateBouton() {
    d3.select("#intervalle").selectAll('g').style('visibility',(d)=> {return page===0?'visible':'hidden';})
    d3.select("#retour").selectAll('g').style('visibility',(d)=> {return page===1?'visible':'hidden';})
    d3.select("#intervalle").raise();
}
//------------
function selPage(idPage) {
		//console.log('Page : '+idPage);
		selMenu=idPage;
		switch (idPage) {
		  case 4 :
//		  click(); //epxxx
	  		try {
                console.log('selPage : live!',dataLive); } catch(e) { console.log('selPage no live!'); dataLive = dataInfo; } /// a enlever !!!
dataLive = dataInfo; //by ep
            livePage();
			break;
          case 3 :
            console.log('new page');
            livePage2();
            break;
		}
}
// ---------
function livePage2() {
        console.log('livePage2');
        let padding=width/420, margeH = 5;
        var largeur = (width-margin.left-margin.right); //console.log(largeur,width);
        let timeSize=width/40, scoreSize = width/15; //25 - 95;
        let teamColor=['#006','#0bc'];
        d3.select('#intervalle').remove();
        d3.select('#infoLive').remove();

        d3.select('#graphe').remove();
        graph=svg.append('g').attr('id','graphe')
            .attr("transform", "translate(" + margin.left + "," + (margin.top) + ")");
        let listeG = graph.selectAll('g').data(dataLive.match.scores).enter()   /// a changer EP
            .append('g').attr('transform',(d,i)=>{return ('translate('+(i*2*largeur/3)+','+(margeH)+')');}).attr('class','cScores');
        //--------------------------------------
        console.log('live page 2 ...');
        //nom des équipes
        listeG.append('rect').attr('rx',2*padding).attr('ry',2*padding).style('stroke-width',padding).style('stroke','#668')
            .attr('width',largeur/3).attr('height',timeSize+scoreSize+padding).style('fill','ivory');//.style('stroke-color', (d,i)=>teamColor[i]); //'#0a88ff');
        listeG.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',(d,i)=>{ return largeur/6;}).attr('y',(timeSize+scoreSize)/2) //.attr('id',(d)=>{return ('en0_'+d.matchId);})
            //.style('fill', (d,i,a) => { return a[i].__data__>a[(i+1)%2].__data__?'#fff':'#ccc';})
            .style('fill','#212')
            .style('text-anchor', 'middle')
            .style('font-weight', 'bold').style('dominant-baseline','middle')
            .text((d,i)=>(dataLive['match']['teams'][i]['name'])).style('font-size','3.5vw');
        listeG.append('rect').attr('rx',1*padding).attr('ry',1*padding).attr('x',largeur/90)
            .attr('width',largeur/30).attr('height',timeSize+scoreSize+padding).style('fill',(d,i)=>teamColor[i]);
        //ranking
        listeG.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',largeur*(1/60+1/90)).attr('y',(timeSize+scoreSize)/3) //.attr('dy','-0.76em')
            .style('fill', '#fff').style('text-anchor', 'middle')
            .style('font-weight', 'bold')
            .text((d,i)=>{ id=dataLive.match.teams[i].id;
                         return (teamsInfo[id].current.pos); })//+' ('+valFormat(teamsInfo[id].current.pts)+') (#'+teamsInfo[id].matches+')');})
            .style('font-size','2vw');
        // on affiche le Stade !
        let  tlSpace = width/14;
        let ret = affStade(largeur,graph,padding,0);

}
// ---------
// page de live lors de la sélection d'un match depuis la page de la compétition
//
function livePage() {
        console.log('livePage',dataLive);
        page=1; updateBouton();
		let padding=width/420, space=0.9,centre=1.6, margeH = 5;
		var largeur = (width-margin.left-margin.right); //console.log(largeur,width);
		let timeSize=width/40, scoreSize = width/15; //25 - 95;
//        d3.select('#intervalle').remove();
//        d3.select('#infoLive').remove();
//        changeComp();

    d3.select("#intervalle").selectAll('g').style('visibility',(d)=> {return page===0?'visible':'hidden';})
    d3.select("#retour").selectAll('g').style('visibility',(d)=> {return page===1?'visible':'hidden';})
    d3.select("#retour").raise();
        d3.select('#graphe').remove();
		graph=svg.append('g').attr('id','graphe')
			.attr("transform", "translate(" + margin.left + "," + (margin.top+45) + ")");


		let listeG = graph.selectAll('g').data(dataLive.match.scores).enter()   /// a changer EP
			.append('g').attr('transform',(d,i)=>{return ('translate('+(i*(largeur/2+padding))+','+(margeH)+')');}).attr('class','cScores');
		//--------------------------------------
		console.log('live page ...');
        //nom des équipes
        listeG.append('rect').attr('rx',2*padding).attr('ry',2*padding)
            .attr('width',largeur/2).attr('height',timeSize+scoreSize+padding).style('fill', (d,i)=>teamColor[i]); //'#0a88ff');
        listeG.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',(d,i)=>{ return (largeur/2+(2*i-1)*scoreSize)/2;}).attr('y',(timeSize+scoreSize)/2) //.attr('id',(d)=>{return ('en0_'+d.matchId);})
            .style('fill', (d,i,a) => { return a[i].__data__>a[(i+1)%2].__data__?'#fff':'#ccc';}).style('text-anchor', 'middle')
            .style('font-weight', 'bold').style('dominant-baseline','middle')
            .text((d,i)=>(dataLive['match']['teams'][i]['name'])).style('font-size','3.5vw');
        // rank
        listeG.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',(d,i)=>{ return (i*largeur/2-2*(2*i-1)*padding)}).attr('y',(timeSize+scoreSize)).attr('dy','-0.76em')
            .style('fill', '#fff').style('text-anchor', (d,i)=> i==0?'begin':'end')
            .style('font-weight', 'normal')
            .text((d,i)=>{ id=dataLive.match.teams[i].id;
                         return ('rank: '+teamsInfo[id].current.pos+' ('+valFormat(teamsInfo[id].current.pts)+') (#'+teamsInfo[id].matches+')');})
            .style('font-size','1vw');
        // POOL
        listeG.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',(d,i)=>{ return (i*largeur/2-2*(2*i-1)*padding)}).attr('y', '1.5em') //(3*padding))
            .style('fill', '#fff').style('text-anchor', (d,i)=> i==0?'begin':'end')
            .style('font-weight', 'normal').text((d,i)=> dataLive.match.eventPhase )
            .style('font-size','1vw');

		// scores
		let scoreG = listeG.append('g') //.data(dataLive.match.scores).enter()   /// a changer EP
			.attr('transform',(d,i)=>{return ('translate('+((i+1)%2*(largeur/2-scoreSize))+','+(timeSize)+')');});
        scoreG.append('rect').attr('rx',2*padding).attr('ry',2*padding)
            .attr('width',scoreSize).attr('height',scoreSize).style('fill', '#2255ff').raise();
        scoreG.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',scoreSize/2).attr('y',scoreSize/2) //.attr('id',(d)=>{return ('en0_'+d.matchId);})
            .style('fill', '#fff').style('text-anchor', 'middle').style('dominant-baseline','middle')
            .style('font-weight', 'bold')
            .text(d=>d).style('font-size','4vw');

        //time
		let time = graph.append('g').attr("transform","translate("+(largeur/2-scoreSize/2)+","+(margeH)+")");
		let min=0,sec=0;
		try {
			min= Math.trunc((dataLive.match.clock.secs)/60); sec=(dataLive.match.clock.secs)%60;
		} catch(e) {}
        time.append('rect').attr('rx',padding).attr('ry',padding).attr('y',2)
            .attr('width',scoreSize+padding).attr('height',timeSize-3).style('fill', '#fff').raise();
        time.append('text').attr('x',0).style('dominant-baseline','middle')
            .attr('dx',scoreSize/2+padding/2).attr('y',timeSize/2).style('fill','#002').style('text-anchor', 'middle')
            .text((d)=>{ return min+' : '+(sec<9?'0':'')+sec;}).style('font-size','1.2vw');

		// les Essai Try
		let tryG = listeG.append('g')
			.attr('transform',(d,i)=>{return ('translate('+(i==0?(largeur/2-scoreSize):(padding))+','+(timeSize+scoreSize+2*padding)+')');});
        tryG.selectAll('g').data((d,i)=> {try { v=(dataLive.teams[i].scoring.Try[0]);return (dataLive.teams[i].scoring.Try);} catch(e){return [];};})
            .enter().append('g').each(function (a,c) {d3.select(this)
            .append('rect').attr('x',(d,j)=>{ return (2*(c+3)*padding);}) //.attr('ry',2*padding)
            .attr('width',padding*2-1).attr('height',padding*2).style('fill', (d,i)=> { return c>3?'#259':'000';}).raise();});
        tryG.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',0).attr('y',padding).style('dominant-baseline','middle')
            .style('fill', '#000').style('text-anchor', 'left').style('font-weight', 'normal')
            .text('Try').style('font-size','0.6vw');

        // les Essai Drop
        let DrGG = listeG.append('g')
            .attr('transform',(d,i)=>{return ('translate('+(i==0?(largeur/2-scoreSize):(padding))+','+(scoreSize+timeSize+5*padding)+')');});
        DrGG.selectAll('g').data((d,i)=> {try {console.log(dataLive.teams[i].scoring.DG[0]);return (dataLive.teams[i].scoring.DG);} catch(e){return [];};})
            .enter().append('g').each(function (a,c) {d3.select(this)
            .append('rect').attr('x',(d,j)=>{ return (2*(c+3)*padding);}) //.attr('ry',2*padding)
            .attr('width',padding*2-1).attr('height',padding*2).style('fill', '#000').raise();});
        DrGG.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',0).attr('y',padding).style('dominant-baseline','middle')
            .style('fill', '#000').style('text-anchor', 'left').style('font-weight', 'normal')
            .text('Drop').style('font-size','0.6vw');
        // les Pénalités
        let PenG = listeG.append('g')
            .attr('transform',(d,i)=>{return ('translate('+(i==0?(largeur/2-scoreSize):(padding))+','+(scoreSize+timeSize+8*padding)+')');});
        PenG.selectAll('g').data((d,i)=> {try {console.log(dataLive.teams[i].scoring.Pen[0]);return (dataLive.teams[i].scoring.Pen);} catch(e){return [];};})
            .enter().append('g').each(function (a,c,i) {d3.select(this)
            .append('rect').attr('x',(d,j)=>{ return (2*(c+3)*padding);}) //.attr('ry',2*padding)
            .attr('width',padding*2-1).attr('height',padding*2).style('fill', '#000').raise();});
        PenG.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',0).attr('y',padding).style('dominant-baseline','middle')
            .style('fill', '#000').style('text-anchor', 'left').style('font-weight', 'normal')
            .text('Pen').style('font-size','0.6vw');
        // les conversions ...
        let ConG = listeG.append('g')
            .attr('transform',(d,i)=>{return ('translate('+(i==0?(largeur/2-scoreSize):(padding))+','+(scoreSize+timeSize+11*padding)+')');});
        ConG.selectAll('g').data((d,i)=> {try {console.log(dataLive.teams[i].scoring.Con[0]);return (dataLive.teams[i].scoring.Con);} catch(e){return [];};})
            .enter().append('g').each(function (a,c,i) {d3.select(this)
            .append('rect').attr('x',(d,j)=>{ return (2*(c+3)*padding);}) //.attr('ry',2*padding)
            .attr('width',padding*2-1).attr('height',padding*2).style('fill', '#000').raise();});
        ConG.append('text').attr('x',0) //.attr('y',10)
            .attr('dx',0).attr('y',padding).style('dominant-baseline','middle')
            .style('fill', '#000').style('text-anchor', 'left').style('font-weight', 'normal')
            .text('Con').style('font-size','0.6vw');
        // les Sanctions
        let YCG = listeG.append('g')
            .attr('transform',(d,i)=>{return ('translate('+(i==0?(largeur/2-scoreSize):(padding))+','+(scoreSize+timeSize-2*padding)+')');});
        YCG.selectAll('g').data((d,i)=> {try {console.log(dataLive.teams[i].disciplinary.YC[0]);return (dataLive.teams[i].disciplinary.YC);} catch(e){return [];};})
            .enter().append('g').each(function (a,c,i) {d3.select(this)
            .append('rect').attr('x',(d,j)=>{ return (2*(c+3)*padding);}) //.attr('ry',2*padding)
            .attr('width',padding*2-1).attr('height',padding*2).style('fill', '#ff0').raise();});
        let RCG = listeG.append('g')
            .attr('transform',(d,i)=>{return ('translate('+(i==0?(largeur/2-scoreSize):(padding))+','+(scoreSize+timeSize-4*padding)+')');});
        YCG.selectAll('g').data((d,i)=> {try {console.log(dataLive.teams[i].disciplinary.RC[0]);return (dataLive.teams[i].disciplinary.RC);} catch(e){return [];};})
            .enter().append('g').each(function (a,c,i) {d3.select(this)
            .append('rect').attr('x',(d,j)=>{ return (2*(c+3)*padding);}) //.attr('ry',2*padding)
            .attr('width',padding*2-1).attr('height',padding*2).style('fill', '#f00').raise();});

        let  tlSpace = width/14;
        let ret = affStade(largeur,graph,padding,tlSpace);
        let stadeSize=ret[1], stadeG = ret[0] , stadeLargeur = ret[2];
        //console.log(stadeSize,stadeLargeur);
		//on affiche les joueurs ...
        let teamG = graph.append('g').attr('transform',(d,i)=>{return ('translate('+(0)+','+(scoreSize+timeSize+5*padding)+')');});
		let motm=0;
		try { motm = dataLive.motm.motm.id; } catch(e) {}
		for (t in [0,1]) {
			let captain = dataLive.teams[t].teamList.captainId;
			teamG.selectAll('g').data(dataLive.teams[t].teamList.list.sort((a, b) => (Number(a.number) > Number(b.number)) ? 1 : -1)).enter()
				.append('text').attr('x',t*(largeur))
				.attr('dy',(d,i)=> {return (i*largeur/60);}).attr('y','0.5em')
				.style('fill', (d)=>{return d.player.id==motm?'#d00':'#000';})
				.style('text-anchor', t==1?'end':'begin').style('font-weight', (d)=>{return ((d.player.id==captain)||(d.player.id==motm))?'bold':'normal';})
				.text((d)=>{return (t==0?((Number(d.number)>9?'':'0')+d.number+' '):'')+d.player.name.display+'  - '+d.positionLabel+' ('+d.player.age.years+' ans)'+(t==1?((Number(d.number)>9?' ':' 0')+d.number+' '):'');})
				.style('font-size','1vw');
		}
        // ranking de la poule ..
        console.log('ranking .... dataStandings',dataStandings);
        let pool = dataLive.match.eventPhase; console.log(pool);
        /*
        let poolG = stadeG.append('g').attr('transform',(d)=>{ return 'translate('+(0)+','+(stadeLargeur*2)+')';});
        poolG.selectAll('g').data(f.entries).enter()
            .append('text').attr('x',0).attr('y',(d,i)=>i*largeur/50).style('text-anchor','begin').style('fill','#004').style('font-weight','bold')
            .text((d)=>{return d.team.name+' - '+d.points+' ['+d.won+'/'+d.lost+'/'+d.drawn+']';}).style('font-size','2vw');
        */
        // tableau de Pool !
        if (pool != 'Quarter-Finals') {
            affPool(stadeG,(stadeSize*2),(stadeLargeur*2),pool);
        }
		// on affiche le live
        let x = d3.scaleLinear()
            .domain([-10, 110]).nice()
            .range([0, stadeSize]);
        let y = d3.scaleLinear()
            .domain([0, 70]).nice()
            .range([stadeLargeur, 0]);
		try {
            let l=dataTimeline.timeline.length, nbTL = Math.trunc(tlSpace/10-0.5);
			var tlFilter = dataTimeline.timeline.filter((x,i)=>{ return (i>= (l-nbTL-1) && (i!=(l-1)));});
			//console.log(tlFilter);
			let infoG = stadeG.append('g').attr('transform','translate(0,'+(-tlSpace+padding)+')')
                    .selectAll('g').data(tlFilter.sort((a, b) => (Number(a.time.secs) > Number(b.time.secs)) ? -1 : 1)).enter();
				infoG.append('rect').attr('width',stadeSize).attr('height',tlSpace-2*padding).style('fill','#259');
				infoG.append('text').text((d)=> {/*console.log(d.type); */return (d.time.label+' ['+dataInfo.match.teams[d.teamIndex].name+'] '+d.typeLabel+' - '+d.info);}).attr('id','infoTimeline')
					.style('fill','white').style('dominant-baseline','middle').style('text-anchor','start')
					.attr('y',(d,i)=>{ return ((i+1))+'em';}).attr('x','10px').style('font-size','1.5vw)');
            console.log(tlFilter[nbTL-1]);
			stadeG.append('g')//.selectAll('circle').data(dataTimeline.timeline[l-1]).enter()
				.append('circle').attr('cx',x(tlFilter[nbTL-1].position.x)).attr('cy',y(tlFilter[nbTL-1].position.y*.7)).attr('r',5).style('fill','red');
			}
		catch(e) {console.log('aff timeline out : erreur ->',e);}

}
function updateRank() {
        teamsInfo[dataRank.team.id]=dataRank;
        nbTeams--;
        if (nbTeams==0) computeScore();
}
function computeScore() {
		//console.log(teamsInfo);
		console.log('Info team lus');
}
//--------------
function affPool(stadeG,dim_x,pos_y,pool) {
    console.log('affiche Pool : function');
        let poolH = ['R','Equipe','Play','Win','Lost','Nul','Pour','Contre','Try','Against','Bonus','Points'];
    let f = dataStandings.tables.find(v=>v.label==pool); console.log('Pool find f:',f);
        var table =  stadeG.append('g').style('fill','black').attr('transform',(d)=>{ return 'translate('+(-0.25*dim_x)+','+(pos_y)+')';})
            .append("foreignObject")
            .attr("width", dim_x)
            .attr("height", '18vw')
            .style('background-color','#007')
            .append("xhtml:table");

        let thead = table.style('font-size','0.9vw').style('width','100%').style('height','100%').append('thead');
            thead.append('tr').style('background-color','black').style('color','white').selectAll('th').data(poolH).enter()
                .append('th').text((d)=>{return d;}).style('padding-right','7px').style('padding-left','7px');
        let tbody = table.append('tbody');
        console.log('affiche table pool',f);
        let tr = tbody.selectAll('tr').data(f.entries).enter().append('tr').style('background-color',(d,i)=>{return (i%2)===0?'#A2FFFB':'#8EDFDC';}).style('color','#249');
            tr.append('th').text((d)=>{return d.positionLabel;});
            tr.append('th').text((d)=>{return d.team.name;}).style('font-size','1.2vw').style('text-align','left');
            tr.append('th').text((d)=>{return d.played;});
            tr.append('th').text((d)=>{return d.won;});
            tr.append('th').text((d)=>{return d.lost;});
            tr.append('th').text((d)=>{return d.drawn;});
            tr.append('th').text((d)=>{return d.pointsFor;});
            tr.append('th').text((d)=>{return d.pointsAgainst;});
            tr.append('th').text((d)=>{return d.triesFor;});
            tr.append('th').text((d)=>{return d.triesAgainst;});
            tr.append('th').text((d)=>{return d.bonusPoints;});
            tr.append('th').text((d)=>{return d.points;}).style('font-size','1.2vw');
}
//--------------
// Affichage de la liste des matches
//
function affListe() {
        console.log('affListe : ',listeMatchs);
        page=0; updateBouton();
        let titre = listeMatchs.event.label;
        //------
        // s'il ya un match en cours on pass au LIVE !
		idLive=0;
		for (m in listeMatchs.matches) {
            switch (listeMatchs.matches[m].status) {
            case 'U':
            case 'UP':
            case 'C':
            case 'CC': break;
            default :
				idLive = listeMatchs.matches[m].matchId;
                console.log('affListe :',idLive,listeMatchs.matches[m]);
				getMatch(idLive);
				t = setInterval(cycle,5000);
				cycle(); //xx
                break;
			}
		}
		teams=[];
        teamsInfo=[]; nbTeams=0;
        listeMatchs.matches.forEach((v)=>{
                if (teams.find((a)=>{ return v.teams[0].id===a;}) == undefined)  { teams.push(v.teams[0].id);   }
                if (teams.find((a)=>{ return v.teams[1].id===a;}) == undefined)  { teams.push(v.teams[1].id);   }
		  }); //console.log(teams);
        nbTeams=teams.length-1;
		teams.forEach((t)=>{
            if (t!=0) {
                let urlRank='http://cmsapi.pulselive.com/rugby/team/'+t+'/ranking';
                getData(urlRank,4);
            }
        });
			//console.log(idLive);
        if (listeMatchs.event.winningTeam!=null) titre += '/' + listeMatchs.event.winningTeam.name;
        d3.select("#h1").text(titre);
		color_status = { U:'ivory',ZZ:'#45CCFF', C:'#456FFF',L1:'#7845FF',L2:'#D545FF', LHT:'#FF45CC', CC:'#9433FF',UP:'red' }
		color_pool = { "Pool A":'#455FFF',"Pool 1":'#455FFF', "Pool B":'#FF45BC',"Pool 2":'#FF45BC',
        "Pool C":'#FFE545',"Pool 3":'#FFE545',"Pool D":'#45FF88','Poule 4':'#45FF88',"Pool 4":'#45FF88',"Pool E":'#A845FF',"Quarter-Finals":'#72A3B4',"Semi-Finals":'#555588',"Bronze Final": '#999','3rd Place Play-Off':'#999',"Final":'#c1a40e', null:'#3380FF' }
        color_tab = ['#3380FF','#4C33FF']
    //    svg.attr("viewBox", "0 0 "+(width + margin.left + margin.right)+" "+((listeVal.length+1)*size));
		let size = 26,padding=2, largeur=110, space=0.9,centre=1.6;
		largeur = (width-margin.left-margin.right) /6; //console.log(largeur,width);
		var jour = new Date();	//console.log(jour.getTimezoneOffset(), jour);
        d3.select('#graphe').remove();
		var graph=svg.append('g').attr('id','graphe')
			.attr("transform", "translate(" + 0 + "," + (margin.top+80) + ")");

        // on tri les match dans l'ordre UP/DOWN
		let listeG = graph.selectAll('g').data(listeMatchs.matches.sort((a, b) => (Number(a.time.millis) > Number(b.time.millis)) ? UP : (-1*UP))).enter()
			.append('g').attr('transform',(d,i)=>{return ('translate('+(2)+','+(i*size+padding/2)+')');});

        //equ 0 - nom
        listeG.append('rect').attr('x',0).attr('id','stat')
            .attr('width',largeur).attr('height',size*space).style('fill', (d,i)=>color_tab[i%2]); //color_pool[d.eventPhase]); //'#0a88ff');
        listeG.append('text').attr('x',padding) //.attr('y',10)
            .attr('dx',(largeur-padding)/2).attr('y',size/centre).attr('id',(d)=>{return ('en0_'+d.matchId);})
            .style('fill', (d) => { return d.scores[0]>=d.scores[1]?'#fff':'#ccc';}).style('text-anchor', 'middle')
            .style('font-weight', (d) => { return d.scores[0]>=d.scores[1]?'bold':'normal';})
            .text((d)=>(d['teams'][0]['name'])).style('font-size','11px');
        //equ 1 - nom
        listeG.append('rect').attr('x',largeur*2).attr('id','stat')
            .attr('width',largeur).attr('height',size*space).style('fill', (d,i)=>color_tab[i%2]); //d=>color_pool[d.eventPhase]);
        listeG.append('text').attr('x',padding) //.attr('y',10)
            .attr('dx',2*largeur+(largeur-padding)/2).attr('y',size/centre).attr('id',(d)=>{return ('en1_'+d.matchId);})
            .style('fill','#fff').style('text-anchor', 'middle').style('fill', (d) => { return d.scores[1]>=d.scores[0]?'#fff':'#ccc';})
            .style('font-weight', (d) => { return d.scores[1]>=d.scores[0]?'bold':'normal';})
            .text((d)=>(d['teams'][1]['name'])).style('font-size','12px');
        //equ 0 : score
        listeG.append('rect').attr('x',largeur+padding).attr('id','stat')
            .attr('width',largeur/3).attr('height',size*space).style('fill',d=>color_pool[d.eventPhase]);
        listeG.append('text').attr('x',padding).attr('id',(d)=>{return ('e0_'+d.matchId);}) //.attr('y',10)
            .attr('dx',largeur+(largeur/3-padding)/2).attr('y',size/centre).style('fill','#fff').style('text-anchor', 'middle')
            .style('fill', (d) => { return d.scores[0]>=d.scores[1]?'#fff':'#ccc';})
            .style('font-weight', (d) => { return d.scores[0]>=d.scores[1]?'bold':'normal';})
            .text((d)=>(d['scores'][0])).style('font-size','12px');
        //equ 1 : score
        listeG.append('rect').attr('x',5*largeur/3-padding).attr('id','stat')
            .attr('width',largeur/3).attr('height',size*space).style('fill',d=>color_pool[d.eventPhase]);
        listeG.append('text').attr('x',padding).attr('id',(d)=>{return ('e1_'+d.matchId);}) //.attr('y',10)
            .attr('dx',5*largeur/3+(largeur/3-3*padding)/2).attr('y',size/centre).style('fill','#fff').style('text-anchor', 'middle')
            .style('fill', (d) => { return d.scores[1]>=d.scores[0]?'#fff':'#ccc';})
            .style('font-weight', (d) => { return d.scores[1]>=d.scores[0]?'bold':'normal';})
            .text((d)=>(d['scores'][1])).style('font-size','12px');
        //en cours ?
        listeG.append('rect').attr('x',4*largeur/3+2*padding).attr('rx',2*padding).attr('ry',2*padding)
            .attr('width',largeur/3-4*padding).attr('height',size*space).style('fill',(d)=>{return d.status=='C'?color_pool[d.eventPhase]:color_status[d.status];})
			.on('click',getInfo)
			.on('mouseover',function(d,i){ d3.select(this).style('fill','#33E6FF');})
			.on('mouseout',function(d,i){ d3.select(this).style('fill',(d)=>{return d.status=='C'?color_pool[d.eventPhase]:color_status[d.status];});});

        listeG.append('text').attr('x',padding).attr('id',(d)=>{return ('m'+d.matchId);}) //.attr('y',10)
            .attr('dx',4*largeur/3+(largeur/3-3*padding)/2).attr('y',size/centre).style('fill','#fff').style('text-anchor', 'middle')
            .style('fill', '#fff').style('font-weight','normal')
//            .text('00:00').style('font-size','10px');
//            .text((d)=>(d.clock))
			.style('font-size','10px');

        //date/heure
        listeG.append('rect').attr('x',3*largeur+padding).attr('id','stat')
            .attr('width',largeur).attr('height',size*space).style('fill', (d,i)=>color_tab[i%2]); //d=>color_pool[d.eventPhase]);
        listeG.append('text').attr('x',3*largeur +padding) //.attr('y',10)
            .attr('dx',(largeur-padding)/2).attr('y',size/centre).style('fill','#fff').style('text-anchor', 'middle')
            .text((d)=>{ jour.setTime(d.time.millis); return jour.toLocaleDateString()+' / '+jour.toLocaleTimeString();}).style('font-size','11px');

        //lieu
        listeG.append('rect').attr('x',4*largeur+2*padding).attr('id','stat')
            .attr('width',largeur*3).attr('height',size*space).style('fill', (d,i)=>color_tab[i%2]); //d=>color_pool[d.eventPhase]); //'#0a88ff');
        listeG.append('text').attr('x',4*largeur +4*padding) //.attr('y',10)
            .attr('dx',padding).attr('y',size/centre).style('fill','#fff').style('text-anchor', 'start')
            .text((d)=>{ return d.venue.name+' ['+d.attendance+'] ('+d.venue.city+'/'+d.venue.country+' )';}).style('font-size','11px');

        if (idComp==1) {
            console.log('affiche Pool six Nations');
            let stadeG = graph.append('g').attr('transform',(d,i)=>{return ('translate('+(width/3)+','+(0)+')');});//(scoreSize+timeSize+25*padding)+')');});
            console.log('dataStandings: (reloaded ?)',dataStandings);
            console.log('listeMatchs:',listeMatchs);
//            let pool = listeMatchs.match.eventPhase;
            affPool(stadeG,(width/1.5),(400),null); //function affPool(stadeG,stadeSize,stadeLargeur,pool)
        }

}// end
//--------------
// Get Info
async function getInfo(d,i) {
        console.log('getInfo');
        console.log('match ',d);
        page=1;
        await timeline(d.matchId);
        await getMatch(d.matchId);
        await stats(d.matchId);
        console.log('getInfo -> match ',d);
}// end getInfo
//------
async function getMatch(id) {
    var urlMatch = 'http://cmsapi.pulselive.com/rugby/match/'+id+'/summary';
    dataInfo=[];
    getData(urlMatch,3);
} // end getMatch
//------------
async function affInfo() {
        try { clock=dataInfo.match.clock.label; } catch(e) {clock='00:00';}
        let mId = '#m'+dataInfo.match.matchId;
        //console.log(clock,mId);
        d3.select(mId).text(clock);
        await timeline(dataInfo.match.matchId);
        affInfoLive(dataInfo);
        selPage(4);
} //end affInfo
//----------
function affInfoLive(data) {
        let nTry0 = 0, nTry1=0;
        try { nTry0 = data.teams[0].scoring.Try.length; } catch(e) {nTry0=0;}
        try { nTry1 = data.teams[1].scoring.Try.length; } catch(e) {nTry1=0;}
        let nPen0 = 0, nPen1=0;
        try { nPen0 = data.teams[0].scoring.Pen.length; } catch(e) {nPen0=0;}
        try { nPen1 = data.teams[1].scoring.Pen.length; } catch(e) {nPen1=0;}
        let nDG0 = 0, nDG1=0;
        try { nDG0 = data.teams[0].scoring.DG.length; } catch(e) {nDG0=0;}
        try { nDG1 = data.teams[1].scoring.DG.length; } catch(e) {nDG1=0;}

        let infoStr=data.match.eventPhase+': '+data.officials[0].official.name.display+' - '
            +data.match.teams[0].name+' ['+nTry0+']'+' ['+nPen0+']'+' ['+nDG0+']'
            +' / '
            +data.match.teams[1].name+' ['+nTry1+']'+' ['+nPen1+']'+' ['+nDG1+']'
            +'  ...        ([Try][Pen][Drop])'
        d3.select('#infoLive').text(infoStr);
} // end affInfoLive
//------
function affLive() {
        clock=dataLive.match.clock.label;
        let mId = '#m'+dataLive.match.matchId;
        console.log("afflive",clock,mId,dataLive);
        d3.select(mId).text(clock);
		if (dataLive.match.status =='C') {
			idLive = 0;
			clearInterval(t);
		}
        let nTry0 = 0, nTry1=0;
        try { nTry0 = dataLive.teams[0].scoring.Con.length; }
        catch(e) {nTry0=0;}

        try { nTry1 = dataLive.teams[1].scoring.Con.length; }
        catch(e) {nTry1=0;}
        console.log(nTry0,nTry1);
        let e0Id = '#e0_'+dataLive.match.matchId, e1Id = '#e1_'+dataLive.match.matchId;
        d3.select(e0Id).text(dataLive.match.scores[0]);
        d3.select(e1Id).text(dataLive.match.scores[1]);
        let en0Id = '#en0_'+dataLive.match.matchId, en1Id = '#en1_'+dataLive.match.matchId;
        d3.select(en0Id).text(dataLive.match.teams[0].name+' ['+nTry0+']');
        d3.select(en1Id).text(dataLive.match.teams[1].name+' ['+nTry1+']');
        affInfoLive(dataLive);
		livePage();
} // end affLive
//---------
// on affiche le Stade
function affStade(largeur,graph,padding,tlSpace) {
        //-----------------------------
        // le stade !
        let stadeSize = largeur/3, poteau;
        let hScores = $('.cScores')[0].getBBox().height;
        //console.log('la taille des scores ... : ',$('.cScores')[0].getBBox().height);
        let x = d3.scaleLinear()
            .domain([-10, 110]).nice()
            .range([0, stadeSize]);
        let stadeLargeur = (x(100)-x(0))*.7;
        let y = d3.scaleLinear()
            .domain([0, 70]).nice()
            .range([stadeLargeur, 0]);
        let lineDash = ['','4,1','12,5'];
        let stadeLine = [[22,0,22,70,0],[78,0,78,70,0],[40,0,40,70,1],[60,0,60,70,1],[0,5,100,5,2],[0,65,100,65,2],[0,15,100,15,2],[0,55,100,55,2]],
            stadePoteau = [[0,35-2.8],[0,35+2.8],[100,35-2.8],[100,35+2.8]];

        let stadeG = graph.append('g').attr('transform',(d,i)=>{return ('translate('+((largeur-stadeSize)/2)+','+(hScores + tlSpace + 1*padding )+')');});//(scoreSize+timeSize+25*padding)+')');});
        stadeG.append('rect').attr('width',x(0)).attr('height',stadeLargeur)
            .style('fill','#071');
        stadeG.append('rect').attr('x',x(0)+1).attr('width',x(40)-1).attr('height',stadeLargeur)
            .style('fill','#192');
        stadeG.append('rect').attr('x',x(50)+1).attr('width',x(40)-1).attr('height',stadeLargeur)
            .style('fill','#192');
        stadeG.append('rect').attr('x',x(100)+1).attr('width',x(0)-1).attr('height',stadeLargeur)
            .style('fill','#071');
        stadeG.selectAll('g').data(stadePoteau).enter()
            .append('circle').attr('cx',d=>x(d[0])).attr('cy',d=>y(d[1])).attr('r',3).style('fill','#fff');
        stadeG.selectAll('g').data(stadeLine).enter()
            .append('line').attr('x1',d=>x(d[0])).attr('y1',d=>y(d[1])).attr('x2',d=>x(d[2])).attr('y2',d=>y(d[3])).style('stroke','#fff').style('stroke-dasharray',d=>lineDash[d[4]]);
        //les infos sur le stade
        stadeG.append('text').attr('x',stadeSize/2).attr('y',stadeLargeur).attr('dy','1em').style('text-anchor','middle').style('fill','#005').text(dataLive.match.venue.name).style('font-size','2.5vw').style('font-weight','bold');
        stadeG.append('text').attr('x',stadeSize/2).attr('y',stadeLargeur).attr('dy','3em').style('text-anchor','middle').style('fill','#005').text(dataLive.match.attendance+' spectateurs').style('font-size','1.5vw');

        let officialG = stadeG.append('g').attr('transform',(d)=>{ return 'translate('+(stadeSize/2)+','+(stadeLargeur*1.33)+')';});
        officialG.selectAll('g').data(dataLive.officials).enter()
            .append('text').attr('x',0).attr('y',(d,i)=>i*largeur/60).style('text-anchor','middle').style('fill','#501').text((d)=>{return d.official.name.display+' - '+d.position+' ['+d.official.country+']';}).style('font-size','1vw');

        //-----------------------
        // on affiche les essai / les pé,nalité et les drops ... ?

        for (t in [0,1]) {
            try {
                stadeG.append('g').selectAll('ellipse').data(dataLive.teams[t].scoring.Try).enter()
                    .append('ellipse').attr('cx',d=>x(d.position.x)).attr('cy',(d,i)=>y(d.position.y*.7)).attr('rx',5).attr('ry',3).style('fill',teamColor[t]);
            } catch(e) {}
            try {
                stadeG.append('g').selectAll('ellipse').data(dataLive.teams[t].scoring.Pen).enter()
                    .append('ellipse').attr('cx',d=>x(d.position.x)).attr('cy',d=>y(d.position.y*.7)).attr('rx',5).attr('ry',3).style('fill',teamColor[t]);
            } catch(e) {}
            try {
                stadeG.append('g').selectAll('ellipse').data(dataLive.teams[t].scoring.DG).enter()
                    .append('ellipse').attr('cx',d=>x(d.position.x)).attr('cy',d=>y(d.position.y*.7)).attr('rx',5).attr('ry',3).style('fill',teamColor[t]);
            } catch(e) {}
        }
    return [stadeG,stadeSize,stadeLargeur];
} //end affStade
//--------------
// Get Data from url
//
function getData(url, type) {
		//console.log(url);
		var opt = fetch(url, {method: 'GET',headers: new Headers({'Access-Control-Allow-Origin':'*','Accept':'application/json',})})
		.then(response => { return response.json();})
		.then(data => {
		// JSON Data
			//console.log(data);
			switch (type) {
				case 1: listeMatchs = [];
						listeMatchs = data;
						dispatch.call('load');
						break;
				case 2: dataLive=[];
						dataLive = data;
						dispatch.call('live');
						break;
                case 3: dataInfo=[];
                        dataInfo = data;
                        dispatch.call('match');
                        break;
                case 4: dataRank = [];
                        dataRank = data;
                        dispatch.call('rank');
                        break;
                case 5: dataTimeline=[];
						dataTimeline = data;
                        dispatch.call('timeline');
                        break;
                case 6: dataStandings=[];
                        dataStandings = data;
                        //console.log(dataStandings);
                        //dispatch.call('load');
                        break;
			}
		})
		.catch(err => {
		// Do something for an error here
			console.log(err);
		});
} //en getData
async function getData2(url) {
        //console.log(url);
        let response = await fetch(url, {method: 'GET',headers: new Headers({'Access-Control-Allow-Origin':'*','Accept':'application/json',})})
        let data = await response.json();
        return data;
} //end Getdata2
</script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-69988969-1', 'auto');
     ga('send', 'pageview');
</script>
</body>
</html>
